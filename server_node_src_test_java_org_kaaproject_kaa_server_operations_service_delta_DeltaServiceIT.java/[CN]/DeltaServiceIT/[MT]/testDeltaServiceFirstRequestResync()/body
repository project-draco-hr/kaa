{
  GetDeltaRequest request=new GetDeltaRequest(application.getApplicationToken(),OLD_ENDPOINT_SEQ_NUMBER,true);
  request.setEndpointProfile(endpointProfile);
  List<EndpointGroupStateDto> changes=new ArrayList<>();
  changes.add(new EndpointGroupStateDto(egAllId,pfAllId,cfAllId));
  HistoryDelta historyDelta=new HistoryDelta(changes,true,false);
  GetDeltaResponse response=deltaService.getDelta(request,historyDelta,NEW_APPLICATION_SEQ_NUMBER);
  endpointConfiguration.setConfigurationHash(EndpointObjectHash.fromSHA1(endpointConfiguration.getConfiguration()).getData());
  assertNotNull(response);
  assertEquals(GetDeltaResponse.GetDeltaResponseType.CONF_RESYNC,response.getResponseType());
  assertEquals(NEW_APPLICATION_SEQ_NUMBER,response.getSequenceNumber());
  assertNotNull(response.getDelta());
  endpointConfigurationBytes=response.getDelta().getData();
  assertNotNull(endpointConfigurationBytes);
  GenericAvroConverter<GenericContainer> converter=new GenericAvroConverter<GenericContainer>(confSchema.getBaseSchema());
  GenericContainer container=converter.decodeBinary(endpointConfigurationBytes);
  assertNotNull(container);
  LOG.info("decoded data {}",container.toString());
}
