{
  basicRegistrationTest();
  createSecondEndpoint();
  byte[] profile=avroConverter.encode(ENDPOINT_PROFILE);
  SyncRequest request=new SyncRequest();
  SyncRequestMetaData md=new SyncRequestMetaData();
  md.setApplicationToken(application.getApplicationToken());
  md.setEndpointPublicKeyHash(ByteBuffer.wrap(EndpointObjectHash.fromSHA1(ENDPOINT_KEY).getData()));
  md.setProfileHash(ByteBuffer.wrap(EndpointObjectHash.fromSHA1(profile).getData()));
  request.setSyncRequestMetaData(md);
  UserSyncRequest userRequest=new UserSyncRequest();
  userRequest.setUserAttachRequest(new UserAttachRequest(USER_EXTERNAL_ID,USER_ACCESS_TOKEN));
  userRequest.setEndpointAttachRequests(Collections.singletonList(new EndpointAttachRequest(REQUEST_ID1,INVALID_ENDPOINT_ACCESS_TOKEN)));
  request.setUserSyncRequest(userRequest);
  SyncResponse response=operationsService.sync(request).getResponse();
  Assert.assertNotNull(response);
  Assert.assertEquals(SyncResponseResultType.SUCCESS,response.getStatus());
  Assert.assertNull(response.getConfigurationSyncResponse());
  Assert.assertNull(response.getNotificationSyncResponse());
  Assert.assertNotNull(response.getUserSyncResponse());
  Assert.assertNotNull(response.getUserSyncResponse().getUserAttachResponse());
  Assert.assertEquals(SyncResponseResultType.SUCCESS,response.getUserSyncResponse().getUserAttachResponse().getResult());
  Assert.assertNotNull(response.getUserSyncResponse().getEndpointAttachResponses());
  Assert.assertEquals(1,response.getUserSyncResponse().getEndpointAttachResponses().size());
  Assert.assertEquals(SyncResponseResultType.FAILURE,response.getUserSyncResponse().getEndpointAttachResponses().get(0).getResult());
}
