{
  basicRegistrationTest();
  byte[] oldProfile=avroConverter.encode(ENDPOINT_PROFILE);
  byte[] profile=avroConverter.encode(NEW_ENDPOINT_PROFILE);
  ClientSync request=new ClientSync();
  ClientSyncMetaData md=new ClientSyncMetaData();
  md.setApplicationToken(application.getApplicationToken());
  md.setEndpointPublicKeyHash(ByteBuffer.wrap(EndpointObjectHash.fromSHA1(ENDPOINT_KEY).getData()));
  md.setProfileHash(ByteBuffer.wrap(EndpointObjectHash.fromSHA1(oldProfile).getData()));
  request.setClientSyncMetaData(md);
  ProfileClientSync profileSync=new ProfileClientSync(null,ByteBuffer.wrap(profile),new EndpointVersionInfo(CONF_SCHEMA_VERSION,PROFILE_SCHEMA_VERSION,1,1,null,1),null);
  request.setProfileSync(profileSync);
  ConfigurationClientSync confSyncRequest=new ConfigurationClientSync();
  confSyncRequest.setAppStateSeqNumber(APPLICATION_SEQ_NUMBER);
  confSyncRequest.setConfigurationHash(ByteBuffer.wrap(currentConfigurationHash));
  request.setConfigurationSync(confSyncRequest);
  SyncContext context=createContext(request);
  operationsService.syncProfile(context,request.getProfileSync());
  operationsService.syncConfiguration(context,request.getConfigurationSync());
  ServerSync response=context.getResponse();
  Assert.assertNotNull(response);
  Assert.assertEquals(SyncStatus.SUCCESS,response.getStatus());
  Assert.assertNotNull(response.getConfigurationSync());
  Assert.assertEquals(SyncResponseStatus.NO_DELTA,response.getConfigurationSync().getResponseStatus());
  Assert.assertEquals(APPLICATION_SEQ_NUMBER,(int)response.getConfigurationSync().getAppStateSeqNumber());
  Assert.assertNull(response.getConfigurationSync().getConfDeltaBody());
  Assert.assertNull(response.getConfigurationSync().getConfSchemaBody());
}
