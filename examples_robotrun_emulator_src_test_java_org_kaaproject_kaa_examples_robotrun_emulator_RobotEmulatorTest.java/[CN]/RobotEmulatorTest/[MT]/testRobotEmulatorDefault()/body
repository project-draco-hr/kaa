{
  RobotEmulator emu=new RobotEmulator(labyrinth,getInitialPosition(),getInitialDirection(),null);
  assertNotNull(emu);
  final Object obj=new Object();
  OK=false;
  emu.registerStateCallback(new StateCallback(){
    @Override public void onDisconnected(){
    }
    @Override public void onConnected(    String deviceName){
synchronized (obj) {
        OK=true;
        obj.notify();
      }
    }
  }
);
  try {
    emu.start();
  }
 catch (  Exception e) {
    Assert.assertTrue(false);
  }
synchronized (obj) {
    try {
      obj.wait(2000);
      assertEquals(true,OK);
    }
 catch (    InterruptedException e) {
      fail("Creator wait failed");
    }
  }
  assertEquals(labyrinth,emu.getLabyrinth());
  assertEquals(getInitialPosition(),emu.getCurrentPosition());
  assertEquals(getInitialDirection(),emu.getCurrentDirection());
  assertEquals(RobotEmulator.DEFAULT_COMMAND_TIMEOUT,emu.getCommandTimeout());
  assertEquals(RobotEmulator.DEFAULT_COMMAND_TIMEOUT_DEVIATION,emu.getTimeoutDeviation());
  assertEquals(RobotEmulator.DEFAULT_PING_TIMEOUT,emu.getPingTimeout());
  emu.shutdown();
}
