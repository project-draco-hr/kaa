{
  BaseLogEventPack logEventPack=getLogEventPack();
  Mockito.when(writer.write(Mockito.anyString(),Mockito.any(Charset.class))).thenReturn(new DummyFuture(){
    @Override public Void get() throws InterruptedException, ExecutionException {
      throw new ExecutionException(new HttpFailureException("fail",500));
    }
  }
);
  LogDeliveryCallback callback=Mockito.mock(LogDeliveryCallback.class);
  appender.doAppend(logEventPack,callback);
  Mockito.verify(callback,Mockito.timeout(10000)).onRemoteError();
}
