{
  List<CTLSchemaMetaInfoDto> missingDependencies=new ArrayList<>();
  Set<CTLSchemaDto> dependencies=new HashSet<>();
  if (schema.getDependencies() != null) {
    for (    CTLSchemaMetaInfoDto dependency : schema.getDependencies()) {
      CTLSchemaDto schemaFound=controlService.getCTLSchemaByFqnVersionAndTenantId(dependency.getFqn(),dependency.getVersion(),schema.getTenantId());
      if (schemaFound == null) {
        missingDependencies.add(dependency);
      }
 else {
        dependencies.add(schemaFound);
      }
    }
  }
  if (!missingDependencies.isEmpty()) {
    String message="The following dependencies are missing from the database: " + Arrays.toString(missingDependencies.toArray());
    throw new IllegalArgumentException(message);
  }
  return dependencies;
}
