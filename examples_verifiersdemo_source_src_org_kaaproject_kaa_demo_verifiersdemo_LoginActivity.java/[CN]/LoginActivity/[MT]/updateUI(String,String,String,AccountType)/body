{
  String kaaVerifierToken=null;
  String userIdCopy=userId;
switch (type) {
case GOOGLE:
    kaaVerifierToken=verifiersTokens.getGoogleKaaVerifierToken();
  Session.getActiveSession().closeAndClearTokenInformation();
userName="Google user name: " + userName;
userId="Google user id: " + userId;
break;
case FACEBOOK:
kaaVerifierToken=verifiersTokens.getFacebookKaaVerifierToken();
userName="Facebook user name: " + userName;
userId="Facebook user id: " + userId;
break;
case TWITTER:
kaaVerifierToken=verifiersTokens.getTwitterKaaVerifierToken();
Session.getActiveSession().closeAndClearTokenInformation();
userName="Twitter user name: " + userName;
userId="Twitter user id: " + userId;
break;
default :
break;
}
curUserName=userName;
curUserId=userId;
curUserInfo="Waiting for Kaa response...";
updateViews();
Log.i(TAG,"Attaching user...");
kaaClient.attachUser(kaaVerifierToken,userIdCopy,token,new UserAttachCallback(){
@Override public void onAttachResult(UserAttachResponse userAttachResponse){
Log.i(TAG,"User was attached... " + userAttachResponse.toString());
if (userAttachResponse.getResult() == SyncResponseResultType.SUCCESS) {
Log.i(TAG,"Successful Kaa verification");
Log.i(TAG,userAttachResponse.toString());
curUserInfo="Successful Kaa verification";
buttonEnabled=true;
updateViews();
EventFamilyFactory eventFamilyFactory=kaaClient.getEventFamilyFactory();
vdecf=eventFamilyFactory.getVerifiersDemoEventClassFamily();
List<String> FQNs=new LinkedList<>();
FQNs.add("org.kaaproject.kaa.demo.verifiersdemo.MessageEvent");
kaaClient.findEventListeners(FQNs,new FindEventListenersCallback(){
@Override public void onRequestFailed(){
Log.i(TAG,"Find event listeners request has failed");
}
@Override public void onEventListenersReceived(List<String> eventListeners){
Log.i(TAG,"Event listeners received: " + eventListeners);
}
}
);
if (listener != null) {
vdecf.removeListener(listener);
}
listener=new KaaEventListener();
}
 else {
String failureString=userAttachResponse.getErrorReason() == null ? userAttachResponse.getErrorCode().toString() : userAttachResponse.getErrorReason().toString();
Log.i(TAG,"Kaa verification failure: " + failureString);
curUserInfo="Kaa verification failure: " + failureString;
buttonEnabled=false;
updateViews();
}
}
}
);
}
