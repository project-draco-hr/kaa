{
  String accessToken=config.getAppId() + "|" + config.getAppSecret();
  LOG.trace("Started token verification with accessToken [{}]",accessToken);
  HttpURLConnection connection=null;
  try {
    connection=establishConnection(userAccessToken,accessToken);
    LOG.trace("Connection established [{}]",accessToken);
    if (connection.getResponseCode() == 400) {
      handle400Response(connection,userExternalId,callback,userAccessToken);
    }
 else     if (connection.getResponseCode() == 200) {
      handle200Response(connection,userExternalId,callback,userAccessToken);
    }
 else {
      LOG.trace("Server response code: {}, no data can be retrieved",connection.getResponseCode());
      callback.onVerificationFailure("Server response code:" + connection.getResponseCode() + ", no data can be retrieved");
    }
  }
 catch (  MalformedURLException e) {
    LOG.debug("Internal error",e);
    callback.onInternalError(e.getMessage());
  }
catch (  IOException e) {
    LOG.debug("Connection error",e);
    callback.onConnectionError(e.getMessage());
  }
catch (  Exception e) {
    LOG.debug("Unexpected error",e);
    callback.onInternalError(e.getMessage());
  }
 finally {
    if (connection != null)     connection.disconnect();
    if (reader != null) {
      try {
        reader.close();
      }
 catch (      IOException e) {
        LOG.debug("Reader can't be closed",e);
      }
    }
  }
}
