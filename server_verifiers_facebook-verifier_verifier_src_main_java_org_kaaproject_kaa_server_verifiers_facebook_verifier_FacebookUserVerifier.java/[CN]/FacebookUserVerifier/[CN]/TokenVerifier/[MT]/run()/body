{
  String accessToken=config.getAppId() + "|" + config.getAppSecret();
  HttpURLConnection connection=null;
  BufferedReader reader=null;
  try {
    connection=establishConnection(userAccessToken,accessToken);
    responseMapper=new ObjectMapper();
    if (connection.getResponseCode() == 400) {
      LOG.trace("400 Bad request");
      callback.onVerificationFailure("400 Bad request");
    }
 else     if (connection.getResponseCode() == 200) {
      reader=new BufferedReader(new InputStreamReader(connection.getInputStream()));
      HashMap<String,Object> responseMap=responseMapper.readValue(reader.readLine(),HashMap.class);
      HashMap<String,Object> dataMap=(HashMap)responseMap.get("data");
      String receivedUserId=(String)dataMap.get("user_id");
      if (receivedUserId == null) {
        HashMap<String,Object> errorMap=(HashMap)dataMap.get("error");
        LOG.trace("Bad input token: {}, errcode = ",errorMap.get("message"),errorMap.get("code"));
        callback.onVerificationFailure("Bad input token: " + errorMap.get("message") + ", errcode = "+ errorMap.get("code"));
      }
 else       if (!receivedUserId.equals(userExternalId)) {
        LOG.trace("Input token {} doesn't belong to the user with {} id",userAccessToken,userExternalId);
        callback.onVerificationFailure("User access token " + userAccessToken + " doesn't belong to the user");
      }
 else {
        LOG.trace("Input token {} is confirmed and belongs to the user with {} id",userAccessToken,userExternalId);
        callback.onSuccess();
      }
    }
 else {
      LOG.trace("Server response code: {}, no data can be retrieved" + connection.getResponseCode());
      callback.onVerificationFailure("Server response code:" + connection.getResponseCode() + ", no data can be retrieved");
    }
  }
 catch (  MalformedURLException e) {
    LOG.debug(e.toString());
    callback.onVerificationFailure("Internal error: malformed url");
  }
catch (  IOException e) {
    LOG.debug(e.toString());
    callback.onVerificationFailure("Internal error: IOException");
  }
 finally {
    if (connection != null)     connection.disconnect();
    if (reader != null) {
      try {
        reader.close();
      }
 catch (      IOException e) {
        LOG.debug(e.toString());
      }
    }
  }
}
