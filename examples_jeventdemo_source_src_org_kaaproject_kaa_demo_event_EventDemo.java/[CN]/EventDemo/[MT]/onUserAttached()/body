{
  List<String> listenerFQNs=new LinkedList<>();
  listenerFQNs.add(ThermostatInfoRequest.class.getName());
  listenerFQNs.add(ChangeDegreeRequest.class.getName());
  kaaClient.findEventListeners(listenerFQNs,new FindEventListenersCallback(){
    @Override public void onEventListenersReceived(    List<String> eventListeners){
      LOG.info("{} event listeners received",eventListeners.size());
      for (      String listener : eventListeners) {
        LOG.info("listener: {}",listener);
      }
    }
    @Override public void onRequestFailed(){
      LOG.info("Request failed");
    }
  }
);
  EventFamilyFactory eventFamilyFactory=kaaClient.getEventFamilyFactory();
  ThermostatEventClassFamily tecf=eventFamilyFactory.getThermostatEventClassFamily();
  tecf.addListener(new ThermostatEventClassFamily.Listener(){
    @Override public void onEvent(    ChangeDegreeRequest changeDegreeRequest,    String senderId){
      LOG.info("ChangeDegreeRequest event fired! change temperature by {} degrees, sender: {}",changeDegreeRequest.getDegree(),senderId);
    }
    @Override public void onEvent(    ThermostatInfoResponse thermostatInfoResponse,    String senderId){
      LOG.info("ThermostatInfoResponse event fired! thermostat info: {}, sender: {}",thermostatInfoResponse.getThermostatInfo(),senderId);
    }
    @Override public void onEvent(    ThermostatInfoRequest thermostatInfoRequest,    String senderId){
      LOG.info("ThermostatInfoRequest event fired! sender: {}",senderId);
    }
  }
);
  tecf.sendEventToAll(new ChangeDegreeRequest(10));
  LOG.info("ChangeDegreeRequest sent");
  TransactionId trxId=eventFamilyFactory.startEventsBlock();
  tecf.addEventToBlock(trxId,new ThermostatInfoRequest());
  tecf.addEventToBlock(trxId,new ChangeDegreeRequest(-30),"thermostat_endpoint_id");
  eventFamilyFactory.submitEventsBlock(trxId);
  LOG.info("Batch of events (ThermostatInfoRequest & ChangeDegreeRequest) sent");
}
