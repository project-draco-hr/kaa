{
  try {
    Log.d("Kaa","Initializing Kaa client...");
    client=Kaa.newClient(new AndroidKaaPlatformContext(context),new KaaStateListener());
    EventFamilyFactory eventFamilyFactory=client.getEventFamilyFactory();
    devices=eventFamilyFactory.getDeviceEventClassFamily();
    devices.addListener(SmartHouseController.this);
    if (deviceType == null || deviceType == DeviceType.THERMOSTAT) {
      thermostats=eventFamilyFactory.getThermoEventClassFamily();
      thermostats.addListener(SmartHouseController.this);
    }
    if (deviceType == null || deviceType == DeviceType.SOUND_SYSTEM) {
      soundSystems=eventFamilyFactory.getMusicEventClassFamily();
      soundSystems.addListener(SmartHouseController.this);
    }
    if (deviceType != null) {
      client.getEndpointRegistrationManager().setAttachedListener(SmartHouseController.this);
      client.getEndpointRegistrationManager().setDetachedListener(SmartHouseController.this);
    }
    client.start();
    Log.d("Kaa","Kaa client initialization completed.");
    onComplete(true);
  }
 catch (  Exception e) {
    Log.e("Kaa","Kaa client initialization failed.",e);
    onException(e);
  }
}
