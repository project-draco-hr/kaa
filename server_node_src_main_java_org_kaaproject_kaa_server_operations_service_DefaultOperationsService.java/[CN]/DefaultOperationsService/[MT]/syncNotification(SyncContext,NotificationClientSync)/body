{
  if (request != null) {
    GetNotificationResponse notificationResponse=calculateNotificationDelta(context.getMetaData().getApplicationToken(),request,context);
    context.setSubscriptionStates(notificationResponse.getSubscriptionStates());
    NotificationServerSync nfSyncResponse=buildNotificationSyncResponse(notificationResponse);
    context.setNotificationSyncResponse(nfSyncResponse);
    context.setUpdateProfileRequired(context.isUpdateProfileRequired() || notificationResponse.isSubscriptionListChanged());
    if (notificationResponse.isSubscriptionListChanged()) {
      context.getEndpointProfile().setSubscriptions(new ArrayList<>(notificationResponse.getSubscriptionSet()));
    }
  }
  return context;
}
