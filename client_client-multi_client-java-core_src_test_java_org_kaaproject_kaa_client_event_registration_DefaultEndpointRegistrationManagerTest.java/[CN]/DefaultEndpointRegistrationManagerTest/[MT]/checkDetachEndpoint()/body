{
  KaaClientState state=mock(KaaClientState.class);
  when(state.getEndpointAccessToken()).thenReturn("");
  DefaultEndpointRegistrationManager manager=spy(new DefaultEndpointRegistrationManager(state,null,null));
  EndpointOperationResultListener listener=mock(EndpointOperationResultListener.class);
  manager.detachEndpoint(new EndpointKeyHash("keyHash1"),listener);
  UserTransport transport=mock(UserTransport.class);
  manager.setUserTransport(transport);
  manager.detachEndpoint(new EndpointKeyHash("keyHash2"),listener);
  manager.detachEndpoint(new EndpointKeyHash("keyHash3"),null);
  verify(transport,times(2)).sync();
}
