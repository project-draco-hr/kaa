{
  buildExtensionHeader(buf,NOTIFICATION_EXTENSION_ID,NOTHING,NOTHING,NOTHING,0);
  int extPosition=buf.position();
  buf.putInt(notificationSync.getAppStateSeqNumber());
  if (notificationSync.getNotifications() != null) {
    buf.put(NF_NOTIFICATIONS_FIELD_ID);
    buf.put(NOTHING);
    buf.putShort((short)notificationSync.getNotifications().size());
    for (    Notification nf : notificationSync.getNotifications()) {
      buf.putInt(nf.getSeqNumber());
      buf.put(nf.getType() == NotificationType.SYSTEM ? SYSTEM : CUSTOM);
      buf.put(NOTHING);
      buf.putShort(nf.getUid() != null ? (short)nf.getUid().length() : (short)0);
      buf.putInt(nf.getBody().array().length);
      long topicId=nf.getTopicId() != null ? Long.valueOf(nf.getTopicId()) : 0l;
      buf.putLong(topicId);
      putUTF(buf,nf.getUid());
      put(buf,nf.getBody().array());
    }
  }
  if (notificationSync.getAvailableTopics() != null) {
    buf.put(NF_TOPICS_FIELD_ID);
    buf.put(NOTHING);
    buf.putShort((short)notificationSync.getAvailableTopics().size());
    for (    Topic t : notificationSync.getAvailableTopics()) {
      buf.putLong(Long.parseLong(t.getId()));
      buf.putShort(t.getSubscriptionType() == SubscriptionType.MANDATORY ? MANDATORY : OPTIONAL);
      buf.put(NOTHING);
      buf.put((byte)t.getName().getBytes(UTF8).length);
      putUTF(buf,t.getName());
    }
  }
  buf.putInt(extPosition - SIZE_OF_INT,buf.position() - extPosition);
}
