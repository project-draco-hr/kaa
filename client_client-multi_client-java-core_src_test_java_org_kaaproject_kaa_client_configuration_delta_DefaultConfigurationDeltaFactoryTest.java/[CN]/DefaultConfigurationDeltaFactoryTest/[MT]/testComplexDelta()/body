{
  URL schemaUrl=Thread.currentThread().getContextClassLoader().getResource("configuration/manager/complexFieldsDeltaSchema.json");
  Schema schema=new Schema.Parser().parse(new File(schemaUrl.getPath()));
  GenericRecord delta=new GenericData.Record(DefaultConfigurationManagerTest.getDeltaSchemaByFullName(schema,"org.kaa.config.testT"));
  DefaultConfigurationManagerTest.fillComplexFullResyncDelta(delta);
  ConfigurationDeltaFactory factory=new DefaultConfigurationDeltaFactory();
  ConfigurationDelta result=factory.createDelta(delta);
  assertTrue(result.hasChanged("testField1"));
  assertTrue(result.hasChanged("testField2"));
  DeltaType testField1=result.getDeltaType("testField1");
  assertFalse(testField1.isDefault());
  assertFalse(testField1.isReset());
  assertNull(testField1.getAddedItems());
  assertNull(testField1.getRemovedItems());
  CharSequence abc=(CharSequence)testField1.getNewValue();
  assertEquals("abc",abc);
  DeltaType testField2=result.getDeltaType("testField2");
  assertFalse(testField2.isDefault());
  assertFalse(testField2.isReset());
  assertNull(testField2.getAddedItems());
  assertNull(testField2.getRemovedItems());
  ConfigurationDelta testField2Delta=(ConfigurationDelta)testField2.getNewValue();
  assertTrue(testField2Delta.hasChanged("testField3"));
  DeltaType testField3=testField2Delta.getDeltaType("testField3");
  assertFalse(testField3.isDefault());
  assertFalse(testField3.isReset());
  assertNull(testField3.getAddedItems());
  assertNull(testField3.getRemovedItems());
  Integer testField3Value=(Integer)testField3.getNewValue();
  assertEquals(new Integer(456),testField3Value);
  DefaultConfigurationManagerTest.fillComplexPartialDelta(delta);
  result=factory.createDelta(delta);
  assertFalse(result.hasChanged("testField1"));
  assertTrue(result.hasChanged("testField2"));
  testField2=result.getDeltaType("testField2");
  testField2Delta=(ConfigurationDelta)testField2.getNewValue();
  assertTrue(testField2Delta.hasChanged("testField3"));
  testField3=testField2Delta.getDeltaType("testField3");
  testField3Value=(Integer)testField3.getNewValue();
  assertEquals(new Integer(654),testField3Value);
}
