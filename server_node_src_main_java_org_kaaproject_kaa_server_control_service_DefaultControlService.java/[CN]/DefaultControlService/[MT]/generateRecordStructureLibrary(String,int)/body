{
  ApplicationDto application=applicationService.findAppById(applicationId);
  if (application == null) {
    throw new NotFoundException("Application not found!");
  }
  LogSchemaDto logSchema=logSchemaService.findLogSchemaByAppIdAndVersion(applicationId,logSchemaVersion);
  if (logSchema == null) {
    throw new NotFoundException("Log schema not found!");
  }
  try {
    CTLSchemaDto logCtlSchema=ctlService.findCTLSchemaById(logSchema.getCtlSchemaId());
    if (logCtlSchema == null) {
      throw new NotFoundException("Log CTL schema not found!");
    }
    Schema recordWrapperSchema=RecordWrapperSchemaGenerator.generateRecordWrapperSchema(logCtlSchema.getBody());
    String fileName=MessageFormatter.arrayFormat(LOG_SCHEMA_LIBRARY_NAME_PATTERN,new Object[]{logSchemaVersion}).getMessage();
    return SchemaLibraryGenerator.generateSchemaLibrary(recordWrapperSchema,fileName);
  }
 catch (  Exception e) {
    LOG.error("Unable to generate Record Structure Library",e);
    throw new ControlServiceException(e);
  }
}
