{
  Preconditions.checkNotNull(properties,"properties object must not be null");
  File file=File.createTempFile("agent","config.properties",stageDir);
  OutputStream os=null;
  try {
    os=new FileOutputStream(file);
    properties.store(os,"Config file for agent: " + agentName);
  }
 catch (  Exception ex) {
    LOGGER.error("Failed to create config file: " + file,ex);
    throw ex;
  }
 finally {
    if (os != null) {
      try {
        os.close();
      }
 catch (      Exception ex) {
        LOGGER.warn("Unable to close config file stream",ex);
      }
    }
  }
  return file;
}
