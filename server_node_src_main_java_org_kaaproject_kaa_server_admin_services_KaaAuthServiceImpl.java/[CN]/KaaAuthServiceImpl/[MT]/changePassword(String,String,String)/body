{
  User currentUser=userFacade.findById(Long.valueOf(getCurrentUser().getExternalUid()));
  User userEntity=userFacade.findByUserName(username);
  if (userEntity == null) {
    return ResultCode.USER_NOT_FOUND;
  }
  if (!userEntity.equals(currentUser)) {
    return ResultCode.PERMISSION_DENIED;
  }
  if (!passwordEncoder.matches(oldPassword,userEntity.getPassword())) {
    return ResultCode.OLD_PASSWORD_MISMATCH;
  }
  if (!checkPasswordStrength(newPassword)) {
    return ResultCode.BAD_PASSWORD_STRENGTH;
  }
  userEntity.setPassword(passwordEncoder.encode(newPassword));
  userEntity.setTempPassword(false);
  userFacade.save(userEntity);
  return ResultCode.OK;
}
