{
  List<EndpointGroupDto> endpointGroups=new ArrayList(11);
  ApplicationDto application=createApplication();
  List<EndpointGroupDto> defaultEndpointGroups=toDtoList(client.getEndpointGroupsByApplicationId(application.getId()));
  endpointGroups.addAll(defaultEndpointGroups);
  for (int i=0; i < 10; i++) {
    EndpointGroupDto endpointGroup=createEndpointGroup(application.getId());
    endpointGroups.add(endpointGroup);
  }
  Collections.sort(endpointGroups,new IdComparator());
  List<EndpointGroupDto> storedEndpointGroups=toDtoList(client.getEndpointGroupsByApplicationId(application.getId()));
  Collections.sort(storedEndpointGroups,new IdComparator());
  Assert.assertEquals(endpointGroups.size(),storedEndpointGroups.size());
  for (int i=0; i < endpointGroups.size(); i++) {
    EndpointGroupDto endpointGroup=endpointGroups.get(i);
    EndpointGroupDto storedEndpointGroup=storedEndpointGroups.get(i);
    assertEndpointGroupsEquals(endpointGroup,storedEndpointGroup);
  }
}
