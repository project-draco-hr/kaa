{
  CTLSchemaDto schema=new CTLSchemaDto();
  JsonNodeFactory factory=JsonNodeFactory.instance;
  schema.setFqn(namespace + "." + name);
  schema.setVersion(version);
  schema.setScope(scope);
  if (scope != CTLSchemaScope.SYSTEM) {
    ApplicationDto application=this.createApplication();
    schema.setTenantId(application.getTenantId());
    schema.setApplicationId(application.getId());
  }
  schema.setDependencies(dependencies);
  ArrayNode jsonFields=factory.arrayNode();
  if (fields != null) {
    for (    Map.Entry<String,String> field : fields.entrySet()) {
      ObjectNode jsonField=factory.objectNode();
      jsonField.put("name",field.getKey());
      jsonField.put("type",field.getValue());
      jsonFields.add(jsonField);
    }
  }
  ObjectNode jsonBody=factory.objectNode();
  jsonBody.put("type","record");
  jsonBody.put("name",name);
  jsonBody.put("namespace",namespace);
  jsonBody.put("fields",jsonFields);
  schema.setBody(jsonBody.toString());
  return client.saveCTLSchema(schema);
}
