{
  List<SubscriptionCommand> subscriptionUpdate=new LinkedList<>();
  for (  String id : topicIds) {
    Topic topic=findTopicById(id);
    if (topic.getSubscriptionType() != SubscriptionType.OPTIONAL_SUBSCRIPTION) {
      LOG.warn("Failed to unsubscribe: topic '{}' isn't optional",id);
      throw new UnavailableTopicException(String.format("Topic '%s' isn't optional",id));
    }
synchronized (topicsListeners) {
      topicsListeners.remove(id);
    }
    subscriptionUpdate.add(new SubscriptionCommand(id,SubscriptionCommandType.REMOVE));
  }
  updateSubscriptionInfo(subscriptionUpdate);
  if (forceSync) {
    doSync();
  }
}
