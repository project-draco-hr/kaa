{
  Validator.validateHash(keyHash,"Incorrect endpoint key hash.");
  EndpointProfile ep=endpointProfileDao.findById(ByteBuffer.wrap(keyHash));
  if (ep != null) {
    int schemaVersion=ep.getServerProfileVersion();
    ep=endpointProfileDao.updateServerProfile(keyHash,schemaVersion,serverProfile);
  }
 else {
    throw new DatabaseProcessingException("Can't find endpoint profile by key hash " + keyHash);
  }
  return ep != null ? ep.toDto() : null;
}
