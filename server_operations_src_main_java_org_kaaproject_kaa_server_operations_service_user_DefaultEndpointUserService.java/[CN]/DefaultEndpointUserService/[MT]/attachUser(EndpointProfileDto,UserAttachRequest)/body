{
  ApplicationDto appDto=applicationService.findAppById(profile.getApplicationId());
  if (endpointService.checkAccessToken(appDto,userAttachRequest.getUserExternalId(),userAttachRequest.getUserAccessToken())) {
    LOG.debug("[{}] received valid attachUserRequest. Assigning endpoint to user.",userAttachRequest.getUserExternalId());
    endpointService.attachEndpointToUser(userAttachRequest.getUserExternalId(),appDto.getTenantId(),profile);
    return new UserAttachResponse(SyncResponseResultType.SUCCESS);
  }
 else {
    LOG.warn("[{}] received invalid attachUserRequest.",userAttachRequest.getUserExternalId());
    return new UserAttachResponse(SyncResponseResultType.FAILURE);
  }
}
