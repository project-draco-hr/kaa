{
  ChannelHandlerContext channelContextMock=Mockito.mock(ChannelHandlerContext.class);
  SyncRequest request=new SyncRequest();
  SyncRequestMetaData md=new SyncRequestMetaData();
  md.setApplicationToken(APP_TOKEN);
  md.setEndpointPublicKeyHash(clientPublicKeyHash);
  request.setSyncRequestMetaData(md);
  SyncResponseHolder holder=simpleResponse;
  Mockito.when(cacheService.getEndpointKey(EndpointObjectHash.fromBytes(clientPublicKeyHash.array()))).thenReturn(clientPair.getPublic());
  Mockito.when(operationsService.sync(request)).thenReturn(holder);
  Assert.assertNotNull(akkaService.getActorSystem());
  ResponseBuilder responseBuilder=Mockito.mock(ResponseBuilder.class);
  ErrorBuilder errorBuilder=Mockito.mock(ErrorBuilder.class);
  SessionInitRequest message1=toSignedRequest(UUID.randomUUID(),ChannelType.HTTP,channelContextMock,request,responseBuilder,errorBuilder);
  SessionInitRequest message2=toSignedRequest(UUID.randomUUID(),ChannelType.HTTP,channelContextMock,request,responseBuilder,errorBuilder);
  akkaService.process(message1);
  akkaService.process(message2);
  Mockito.verify(operationsService,Mockito.timeout(TIMEOUT).atLeast(2)).sync(request);
  Mockito.verify(responseBuilder,Mockito.timeout(TIMEOUT).atLeast(2)).build(Mockito.any(byte[].class));
}
