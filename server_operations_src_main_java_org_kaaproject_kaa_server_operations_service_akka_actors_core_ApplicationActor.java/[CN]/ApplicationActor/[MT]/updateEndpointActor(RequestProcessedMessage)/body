{
  String endpointKey=message.getEndpointActorKey();
  LOG.debug("Update EndpointSession for actor {}",endpointKey);
  ActorMetaData endpointMetaData=endpointSessions.get(endpointKey);
  if (endpointMetaData != null) {
    boolean requestFound=endpointMetaData.registerResponse(message.getRequestHash());
    if (requestFound) {
      int pendingRequestSize=endpointMetaData.getPendingRequestsSize();
      if (pendingRequestSize == 0) {
        LOG.debug("No more pending requests for endpointKey {}. Going to stop endpoint actor.",endpointKey);
        context().stop(endpointMetaData.actorRef);
        endpointSessions.remove(endpointKey);
      }
 else {
        LOG.debug("There is still {} pending requests for endpointKey {}",pendingRequestSize,endpointKey);
      }
    }
 else {
      LOG.warn("Pending request {} is not found!",message.getRequestHash());
    }
  }
 else {
    LOG.warn("EndpointSession for actor {} is not found!",endpointKey);
  }
}
