{
  if (System.getProperty("user.home") != null && new File(System.getProperty("user.home")).exists()) {
    String tempDir=System.getProperty("user.home") + "/temp_dir_" + System.currentTimeMillis();
    fileSystemLogEventService.createDirectory(tempDir);
    DailyRollingFileAppender fileAppender=new DailyRollingFileAppender();
    fileAppender.setFile(tempDir + TEST_FILE);
    fileAppender.setDatePattern("'.'yyyy-MM-dd-HH-mm");
    fileAppender.setAppend(true);
    fileAppender.setLayout(new PatternLayout("%m%n"));
    fileAppender.activateOptions();
    org.apache.log4j.Logger logger=org.apache.log4j.Logger.getLogger("test" + System.currentTimeMillis());
    LogEventDto logEventDto=new LogEventDto(TEST_HEADER,TEST_EVENT);
    String realEvent=new StringBuilder("{\"Log Header\": \"").append(TEST_HEADER).append("\", \"Event\": ").append(TEST_EVENT).append("}").append(System.getProperty("line.separator")).toString();
    fileSystemLogEventService.save(Collections.singletonList(logEventDto),logger,fileAppender);
    byte[] encoded=Files.readAllBytes(Paths.get(tempDir + TEST_FILE));
    String eventFromFile=new String(encoded,UTF_8);
    fileAppender.close();
    Assert.assertEquals(realEvent,eventFromFile);
    fileSystemLogEventService.removeAll(tempDir);
  }
}
