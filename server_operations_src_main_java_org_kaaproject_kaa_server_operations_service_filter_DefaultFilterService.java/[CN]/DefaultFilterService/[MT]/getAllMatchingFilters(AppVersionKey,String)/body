{
  ProfileSchemaDto profileSchema=cacheService.getProfileSchemaByAppAndVersion(appProfileVersionKey);
  List<ProfileFilterDto> filters=cacheService.getFilters(appProfileVersionKey);
  LOG.trace("Found {} filters by {}",filters.size(),appProfileVersionKey);
  List<ProfileFilterDto> matchingFilters=new LinkedList<ProfileFilterDto>();
  Filter filter=null;
  for (  ProfileFilterDto filterBody : filters) {
    if (filter == null) {
      filter=new DefaultFilter(filterBody.getBody(),profileSchema.getSchema());
    }
 else {
      filter.updateFilterBody(filterBody.getBody());
    }
    LOG.trace("matching profile body with filter {}",filter);
    if (filter.matches(profileBody)) {
      matchingFilters.add(filterBody);
      LOG.trace("profile body matched");
    }
  }
  return matchingFilters;
}
