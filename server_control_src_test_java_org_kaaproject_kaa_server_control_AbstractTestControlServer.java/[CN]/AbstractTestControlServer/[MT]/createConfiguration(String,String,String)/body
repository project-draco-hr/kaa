{
  ConfigurationDto configuration=new ConfigurationDto();
  String config=getResourceAsString(TEST_CONFIGURATION);
  configuration.setStatus(UpdateStatus.INACTIVE);
  if (strIsEmpty(applicationId)) {
    ApplicationDto application=createApplication();
    configuration.setApplicationId(application.getId());
    applicationId=application.getId();
  }
 else {
    configuration.setApplicationId(applicationId);
  }
  ConfigurationSchemaDto configSchema=null;
  if (strIsEmpty(configurationSchemaId)) {
    configSchema=createConfigurationSchema(applicationId);
    configuration.setSchemaId(configSchema.getId());
  }
 else {
    configuration.setSchemaId(configurationSchemaId);
    configSchema=toDto(client.getConfigurationSchema(configurationSchemaId));
  }
  if (strIsEmpty(endpointGroupId)) {
    EndpointGroupDto endpointGroup=createEndpointGroup(applicationId);
    configuration.setEndpointGroupId(endpointGroup.getId());
  }
 else {
    configuration.setEndpointGroupId(endpointGroupId);
  }
  GenericAvroConverter converter=new GenericAvroConverter(configSchema.getOverrideSchema());
  configuration.setBody(converter.endcodeToJson(converter.decodeJson(config)));
  ConfigurationDto savedConfiguration=toDto(client.editConfiguration(toDataStruct(configuration)));
  return savedConfiguration;
}
