{
  LOG.trace("Getting new record block with block size = {} and count = {}",blockSize,batchCount);
  if (blockSize > maxBucketSize || batchCount > maxBucketRecordCount) {
    LOG.warn("Resize of record block is not supported yet");
  }
  LogBlock result=null;
synchronized (buckets) {
    for (    MemBucket bucket : buckets.values()) {
      if (bucket.getState() == MemBucketState.FREE) {
        result=new LogBlock(bucket.id,bucket.getRecords());
      }
      if (bucket.getState() == MemBucketState.FULL) {
        bucket.setState(MemBucketState.PENDING);
        result=new LogBlock(bucket.id,bucket.getRecords());
        break;
      }
    }
  }
  if (result != null) {
    LOG.debug("Return record block [{}]",result.getBlockId());
  }
  return result;
}
