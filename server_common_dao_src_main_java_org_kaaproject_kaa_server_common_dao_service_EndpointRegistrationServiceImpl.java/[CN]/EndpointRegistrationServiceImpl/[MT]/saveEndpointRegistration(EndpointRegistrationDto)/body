{
  try {
    Validate.notNull(endpointRegistration,"Invalid endpoint registration provided!");
    String credentialsId=endpointRegistration.getCredentialsId();
    Optional<EndpointRegistrationDto> oldRegistration=findEndpointRegistrationByCredentialsId(credentialsId);
    Validate.isTrue(!oldRegistration.isPresent(),"The endpoint registration already exists!");
    return this.endpointRegistrationDao.save(endpointRegistration).toDto();
  }
 catch (  Exception cause) {
    LOG.error("An unexpected exception occured while saving endpoint registration!",cause);
    throw new EndpointRegistrationServiceException(cause);
  }
}
