{
  super();
  this.accessCode=accessCode;
  this.rootPath=rootPath;
  this.library=new MediaLibrary(rootPath);
  this.client=Kaa.newClient(new DesktopKaaPlatformContext(),new SimpleKaaClientStateListener(){
    @Override public void onStarted(){
      client.attachUser(DEFAULT_USER_NAME,"",new UserAttachCallback(){
        @Override public void onAttachResult(        UserAttachResponse arg0){
          LOG.info("Endpoint attached to default user: {}",DEFAULT_USER_NAME);
        }
      }
);
      LOG.info("Kaa client started");
      statusUpdateThread=new StatusUpdateThread();
      statusUpdateThread.start();
    }
  }
);
  EventFamilyFactory factory=client.getEventFamilyFactory();
  this.deviceECF=factory.getDeviceEventClassFamily();
  this.musicECF=factory.getMusicEventClassFamily();
  this.geoECF=factory.getGeoFencingEventClassFamily();
  this.state=new MusicPlayerState(STATE_FILE_NAME);
}
