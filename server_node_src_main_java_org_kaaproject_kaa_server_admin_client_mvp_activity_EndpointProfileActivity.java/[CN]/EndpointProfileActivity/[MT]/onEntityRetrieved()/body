{
  detailsView.reset();
  final EndpointProfileDto profileDto=entity.getEndpointProfileDto();
  EndpointUserDto userDto=entity.getEndpointUserDto();
  final ProfileSchemaDto profileSchemaDto=entity.getProfileSchemaDto();
  final ServerProfileSchemaDto serverProfileSchemaDto=entity.getServerProfileSchemaDto();
  detailsView.getKeyHash().setValue(BaseEncoding.base64().encode(profileDto.getEndpointKeyHash()));
  if (userDto != null) {
    detailsView.getUserID().setValue(userDto.getId());
    detailsView.getUserExternalID().setValue(userDto.getExternalId());
    for (    Widget widget : detailsView.getUserInfoList()) {
      widget.setVisible(true);
    }
  }
 else {
    for (    Widget widget : detailsView.getUserInfoList()) {
      widget.setVisible(false);
    }
  }
  List<EndpointGroupDto> groupDtoList=entity.getGroupDtoList();
  if (groupDtoList != null) {
    detailsView.getGroupsGrid().getDataGrid().setRowData(groupDtoList);
  }
  List<TopicDto> endpointNotificationTopics=entity.getEndpointNotificationTopics();
  if (endpointNotificationTopics != null) {
    detailsView.getTopicsGrid().getDataGrid().setRowData(endpointNotificationTopics);
  }
 else   detailsView.getTopicsGrid().getDataGrid().setRowData(new ArrayList<TopicDto>());
  detailsView.getEndpointProfSchemaName().setText(profileSchemaDto.getName());
  registrations.add(detailsView.getEndpointProfSchemaName().addClickHandler(new ClickHandler(){
    @Override public void onClick(    ClickEvent clickEvent){
      ProfileSchemaPlace endpointProfSchemaPlace=new ProfileSchemaPlace(place.getApplicationId(),profileSchemaDto.getId());
      endpointProfSchemaPlace.setPreviousPlace(place);
      goTo(endpointProfSchemaPlace);
    }
  }
));
  final RecordField endpointProfileRecord=entity.getEndpointProfileRecord();
  if (endpointProfileRecord != null) {
    detailsView.getEndpointProfForm().reset();
    detailsView.getEndpointProfForm().setValue(endpointProfileRecord);
  }
  registrations.add(detailsView.getDeleteButton().addClickHandler(new ClickHandler(){
    @Override public void onClick(    ClickEvent clickEvent){
      deleteItem(profileDto);
    }
  }
));
  RecordField serverProfileRecord=entity.getServerProfileRecord();
  if (serverProfileRecord != null) {
    detailsView.getAddButton().setEnabled(false);
    detailsView.getEditButton().setEnabled(true);
    detailsView.getDeleteButton().setEnabled(true);
    detailsView.getServerProfForm().reset();
    detailsView.getServerProfForm().setValue(serverProfileRecord);
    detailsView.getServerProfForm().setReadOnly(true);
    detailsView.getServerProfRecord().clear();
    detailsView.getServerProfRecord().setValue(serverProfileRecord);
  }
 else {
    detailsView.getAddButton().setEnabled(true);
    detailsView.getDeleteButton().setEnabled(false);
    detailsView.getEditButton().setEnabled(false);
  }
  registrations.add(detailsView.getServerProfForm().addValueChangeHandler(new ValueChangeHandler<RecordField>(){
    @Override public void onValueChange(    ValueChangeEvent<RecordField> valueChangeEvent){
      updateButtonsState();
    }
  }
));
  registrations.add(detailsView.getServerProfRecord().addValueChangeHandler(new ValueChangeHandler<RecordField>(){
    @Override public void onValueChange(    ValueChangeEvent<RecordField> valueChangeEvent){
      updateSaveProfileButtonState();
    }
  }
));
  if (serverProfileSchemaDto != null) {
    String serverProfName=serverProfileSchemaDto.getSchemaDto().getName();
    detailsView.getServerProfSchemaName().setText(serverProfName != null ? serverProfName : "");
    registrations.add(detailsView.getServerProfSchemaName().addClickHandler(new ClickHandler(){
      @Override public void onClick(      ClickEvent clickEvent){
        ServerProfileSchemaPlace serverProfSchemaPlace=new ServerProfileSchemaPlace(place.getApplicationId(),serverProfileSchemaDto.getId());
        serverProfSchemaPlace.setPreviousPlace(place);
        goTo(serverProfSchemaPlace);
      }
    }
));
  }
  KaaAdmin.getDataSource().loadServerProfileSchemas(place.getApplicationId(),new AsyncCallback<List<ServerProfileSchemaDto>>(){
    @Override public void onFailure(    Throwable throwable){
      org.kaaproject.kaa.server.admin.client.util.Utils.handleException(throwable,detailsView);
    }
    @Override public void onSuccess(    List<ServerProfileSchemaDto> result){
      detailsView.getServerSchemasListBox().setAcceptableValues(result);
      if (serverProfileSchemaDto != null && serverProfileSchemaDto.getId() != null) {
        for (        ServerProfileSchemaDto dto : result) {
          if (serverProfileSchemaDto.getId().equals(dto.getId())) {
            detailsView.getServerSchemasListBox().setValue(dto);
          }
        }
      }
 else {
        detailsView.getServerSchemasListBox().setValue(result.isEmpty() ? null : result.get(0));
      }
    }
  }
);
  registrations.add(detailsView.getServerSchemasListBox().addValueChangeHandler(new ValueChangeHandler<ServerProfileSchemaDto>(){
    @Override public void onValueChange(    ValueChangeEvent<ServerProfileSchemaDto> valueChangeEvent){
      String schema=valueChangeEvent.getValue().getSchemaDto().getBody();
      KaaAdmin.getDataSource().generateRecordFromSchemaJson(schema,new AsyncCallback<RecordField>(){
        @Override public void onFailure(        Throwable throwable){
          org.kaaproject.kaa.server.admin.client.util.Utils.handleException(throwable,detailsView);
        }
        @Override public void onSuccess(        RecordField recordField){
          detailsView.getServerProfRecord().setValue(recordField);
        }
      }
);
    }
  }
));
  registrations.add(detailsView.getSaveProfileButton().addClickHandler(new ClickHandler(){
    @Override public void onClick(    ClickEvent clickEvent){
      EndpointProfileRecordFieldDto endpointProfileRecordFieldDto=new EndpointProfileRecordFieldDto();
      final RecordField value=detailsView.getServerProfRecord().getValue();
      String serverSchemaId=detailsView.getServerSchemasListBox().getValue().getId();
      final String serverSchemaName=detailsView.getServerSchemasListBox().getValue().getSchemaDto().getName();
      profileDto.setServerProfileSchemaId(serverSchemaId);
      endpointProfileRecordFieldDto.setProfileRecord(value);
      endpointProfileRecordFieldDto.setProfileDto(profileDto);
      KaaAdmin.getDataSource().updateEndpointProfile(endpointProfileRecordFieldDto,new AsyncCallback<EndpointProfileRecordFieldDto>(){
        @Override public void onFailure(        Throwable throwable){
          org.kaaproject.kaa.server.admin.client.util.Utils.handleException(throwable,detailsView);
        }
        @Override public void onSuccess(        EndpointProfileRecordFieldDto endpointProfileDto){
          detailsView.getServerProfForm().reset();
          detailsView.getServerProfForm().setValue(value);
          detailsView.getServerProfSchemaName().setText(serverSchemaName);
          detailsView.getAddButton().setEnabled(false);
          detailsView.getEditButton().setEnabled(true);
          detailsView.getDeleteButton().setEnabled(true);
        }
      }
);
    }
  }
));
}
