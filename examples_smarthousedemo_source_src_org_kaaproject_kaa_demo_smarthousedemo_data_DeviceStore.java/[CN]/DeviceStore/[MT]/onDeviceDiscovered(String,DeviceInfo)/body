{
  SmartDeviceInfo device=SmartDeviceInfo.createDeviceInfo(endpointKey,deviceInfo.getDeviceType());
  List<SmartDeviceInfo> devices=deviceMap.get(device.getDeviceType());
  if (!devices.contains(device)) {
    device.setDeviceName(generateDeviceName(device.getDeviceType()));
    SmartDeviceInfo savedDevice=datasource.addDevice(device);
    savedDevice.setDeviceStatus(DeviceStatus.ONLINE);
    devices.add(savedDevice);
    DeviceAdded deviceAdded=new DeviceAdded();
    deviceAdded.device=savedDevice;
    eventBus.post(deviceAdded);
  }
 else {
    int index=devices.indexOf(device);
    SmartDeviceInfo storedDevice=devices.get(index);
    storedDevice.setDeviceStatus(DeviceStatus.ONLINE);
    DeviceUpdated deviceUpdated=new DeviceUpdated();
    deviceUpdated.device=storedDevice;
    eventBus.post(deviceUpdated);
  }
}
