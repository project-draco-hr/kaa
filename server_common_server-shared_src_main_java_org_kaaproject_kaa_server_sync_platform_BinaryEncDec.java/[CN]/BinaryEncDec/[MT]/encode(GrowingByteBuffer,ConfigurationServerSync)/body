{
  int option=0;
  boolean confSchemaPresent=configurationSync.getConfSchemaBody() != null;
  boolean confBodyPresent=configurationSync.getConfDeltaBody() != null;
  if (confSchemaPresent) {
    option|=0x01;
  }
  if (confBodyPresent) {
    option|=0x02;
  }
  buildExtensionHeader(buf,CONFIGURATION_EXTENSION_ID,NOTHING,NOTHING,(byte)option,0);
  int extPosition=buf.position();
  buf.putInt(configurationSync.getAppStateSeqNumber());
  if (confSchemaPresent) {
    buf.putInt(configurationSync.getConfSchemaBody().array().length);
  }
  if (confBodyPresent) {
    buf.putInt(configurationSync.getConfDeltaBody().array().length);
  }
  if (confSchemaPresent) {
    buf.put(configurationSync.getConfSchemaBody().array());
  }
  if (confBodyPresent) {
    buf.put(configurationSync.getConfDeltaBody().array());
  }
  buf.putInt(extPosition - SIZE_OF_INT,buf.position() - extPosition);
}
