{
  EndpointSpecificConfigurationDto dto=new EndpointSpecificConfigurationDto();
  dto.setConfigurationVersion(null);
  dto.setEndpointKeyHash(KEY);
  dto.setConfiguration(CONFIG_BODY);
  when(endpointServiceMock.findEndpointProfileByKeyHash(DECODED_KEY)).thenReturn(generateProfile());
  when(configurationServiceMock.validateOverrideConfigurationBody(APP_ID,CONF_VERSION,CONFIG_BODY)).thenReturn("valid body");
  when(daoMock.save(dto)).thenReturn(configuration);
  when(configuration.toDto()).thenReturn(new EndpointSpecificConfigurationDto());
  Assert.assertTrue(SERVICE.save(dto) != null);
  verify(configurationServiceMock).validateOverrideConfigurationBody(APP_ID,CONF_VERSION,CONFIG_BODY);
  verify(endpointServiceMock).findEndpointProfileByKeyHash(DECODED_KEY);
  verify(daoMock).save(dto);
}
