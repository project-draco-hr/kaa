{
  when(endpointServiceMock.findEndpointProfileByKeyHash(DECODED_KEY)).thenReturn(generateProfile());
  when(daoMock.findByEndpointKeyHashAndConfigurationVersion(KEY,CONF_VERSION)).thenReturn(configuration);
  when(configuration.toDto()).thenReturn(new EndpointSpecificConfigurationDto());
  Assert.assertTrue(SERVICE.deleteByEndpointKeyHash(KEY).isPresent());
  verify(endpointServiceMock).findEndpointProfileByKeyHash(DECODED_KEY);
  verify(daoMock).findByEndpointKeyHashAndConfigurationVersion(KEY,CONF_VERSION);
  verify(daoMock).removeByEndpointKeyHash(KEY);
}
