{
  validateCTLSchemaObject(unSavedSchema);
  CTLSchemaMetaInfoDto metaInfo=unSavedSchema.getMetaInfo();
  CTLSchemaScopeDto currentScope=null;
  if (isBlank(unSavedSchema.getTenantId())) {
    currentScope=SYSTEM;
  }
 else   if (!isBlank(unSavedSchema.getTenantId())) {
    currentScope=TENANT;
  }
 else   if (!isBlank(unSavedSchema.getAppId())) {
    currentScope=APPLICATION;
  }
  metaInfo.setSchemaScopeDto(currentScope);
  CTLSchemaMetaInfo uniqueMetaInfo;
  try {
    uniqueMetaInfo=schemaMetaInfoDao.save(new CTLSchemaMetaInfo(metaInfo));
  }
 catch (  Exception e) {
    LOG.warn("---> Got rollback during save metainfo object.");
    uniqueMetaInfo=schemaMetaInfoDao.findByFqnAndVersion(metaInfo.getFqn(),metaInfo.getVersion());
  }
switch (uniqueMetaInfo.getSchemaScopeDto()) {
case SYSTEM:
    throw new RuntimeException("Disable to store system ctl schema with same fqn and version.");
case TENANT:
  if (currentScope == SYSTEM) {
    throw new RuntimeException("Disable to store system ctl schema. Tenant's scope schema already exists with the same fqn and version.");
  }
break;
case APPLICATION:
break;
default :
break;
}
CTLSchema ctlSchema=new CTLSchema(unSavedSchema);
ctlSchema.setMetaInfo(uniqueMetaInfo);
CTLSchemaDto dto=getDto(ctlSchemaDao.save(ctlSchema));
schemaMetaInfoDao.incrementCount(uniqueMetaInfo);
return dto;
}
