{
  VoltageReport report=decode(reportBody);
  if (report == null) {
    return Response.status(Status.BAD_REQUEST).build();
  }
  long ts=System.currentTimeMillis();
synchronized (updateLock) {
    for (    VoltageSample sample : report.getSamples()) {
      LOG.trace("processing {}",sample);
      Integer panelId=sample.getPanelId();
      SortedSet<DataPoint> sampleSet=voltageSamplesMap.get(panelId);
      if (sampleSet == null) {
        LOG.trace("[{}] no samples for this panel yet",panelId);
        sampleSet=Collections.synchronizedSortedSet(new TreeSet<DataPoint>(DataPoint.TS_COMPARATOR));
        SortedSet<DataPoint> curSet=voltageSamplesMap.put(panelId,sampleSet);
        if (curSet != null) {
          sampleSet=curSet;
        }
      }
      sampleSet.add(convert(sample,ts));
      if (sampleSet.size() == MAX_SAMPLES) {
        DataPoint old=sampleSet.first();
        sampleSet.remove(old);
        LOG.trace("[{}] removing old data {}",panelId,old);
      }
    }
  }
  return Response.noContent().build();
}
