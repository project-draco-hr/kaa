{
  MessageEncoderDecoder messageEncDec=getEncoderDecoder();
  byte[] requestBodyRaw=converter.toByteArray(request);
  byte[] requestKeyEncoded=messageEncDec.getEncodedSessionKey();
  byte[] requestBodyEncoded=messageEncDec.encodeData(requestBodyRaw);
  byte[] signature=messageEncDec.sign(requestBodyEncoded);
  if (LOG.isTraceEnabled()) {
    LOG.trace("Signature size: {}",signature.length);
    LOG.trace(MessageEncoderDecoder.bytesToHex(signature));
    LOG.trace("RequestKeyEncoded size: {}",requestKeyEncoded.length);
    LOG.trace(MessageEncoderDecoder.bytesToHex(requestKeyEncoded));
    LOG.trace("RequestBodyEncoded size: {}",requestBodyEncoded.length);
    LOG.trace(MessageEncoderDecoder.bytesToHex(requestBodyEncoded));
  }
  MultipartEntityBuilder builder=MultipartEntityBuilder.create();
  builder.addBinaryBody(CommonEPConstans.REQUEST_SIGNATURE_ATTR_NAME,signature);
  builder.addBinaryBody(CommonEPConstans.REQUEST_KEY_ATTR_NAME,requestKeyEncoded);
  builder.addBinaryBody(CommonEPConstans.REQUEST_DATA_ATTR_NAME,requestBodyEncoded);
  HttpEntity requestEntity=builder.build();
  return requestEntity;
}
