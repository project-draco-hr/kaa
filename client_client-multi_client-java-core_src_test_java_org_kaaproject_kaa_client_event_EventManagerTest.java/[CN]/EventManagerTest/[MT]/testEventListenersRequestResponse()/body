{
  KaaClientPropertiesState state=new KaaClientPropertiesState(new FilePersistentStorage(),CommonsBase64.getInstance(),KaaClientPropertiesStateTest.getProperties());
  EventTransport transport=Mockito.mock(EventTransport.class);
  SimpleExecutorContext executorContext=new SimpleExecutorContext();
  executorContext.init();
  EventManager eventManager=new DefaultEventManager(state,executorContext,transport);
  List<String> eventFQNs=new ArrayList<String>();
  eventFQNs.add("eventFQN1");
  FindEventListenersCallback fetchListener=mock(FindEventListenersCallback.class);
  int requestIdOk=eventManager.findEventListeners(eventFQNs,fetchListener);
  int requestIdBad=eventManager.findEventListeners(eventFQNs,fetchListener);
  verify(transport,atLeast(1)).sync();
  List<EventListenersResponse> response=new ArrayList<EventListenersResponse>();
  response.add(new EventListenersResponse(requestIdOk,new ArrayList<String>(),SyncResponseResultType.SUCCESS));
  response.add(new EventListenersResponse(requestIdBad,new ArrayList<String>(),SyncResponseResultType.FAILURE));
  eventManager.eventListenersResponseReceived(response);
  verify(fetchListener,Mockito.timeout(1000).times(1)).onEventListenersReceived(anyListOf(String.class));
  verify(fetchListener,Mockito.timeout(1000).times(1)).onRequestFailed();
  executorContext.stop();
}
