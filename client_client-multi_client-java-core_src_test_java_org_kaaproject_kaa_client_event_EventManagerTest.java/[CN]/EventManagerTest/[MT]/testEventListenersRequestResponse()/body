{
  KaaClientPropertiesState state=new KaaClientPropertiesState(new FilePersistentStorage(),KaaClientPropertiesStateTest.getProperties());
  EventTransport transport=Mockito.mock(EventTransport.class);
  EventManager eventManager=new DefaultEventManager(state,transport);
  List<String> eventFQNs=new ArrayList<String>();
  eventFQNs.add("eventFQN1");
  FetchEventListeners fetchListener=mock(FetchEventListeners.class);
  int requestIdOk=eventManager.findEventListeners(eventFQNs,fetchListener);
  int requestIdBad=eventManager.findEventListeners(eventFQNs,fetchListener);
  verify(transport,atLeast(1)).sync();
  List<EventListenersResponse> response=new ArrayList<EventListenersResponse>();
  response.add(new EventListenersResponse(requestIdOk,new ArrayList<String>(),SyncResponseResultType.SUCCESS));
  response.add(new EventListenersResponse(requestIdBad,new ArrayList<String>(),SyncResponseResultType.FAILURE));
  eventManager.eventListenersResponseReceived(response);
  verify(fetchListener,times(1)).onEventListenersReceived(anyListOf(String.class));
  verify(fetchListener,times(1)).onRequestFailed();
}
