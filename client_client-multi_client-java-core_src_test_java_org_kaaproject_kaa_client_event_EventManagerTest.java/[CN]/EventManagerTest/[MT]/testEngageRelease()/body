{
  KaaClientPropertiesState state=new KaaClientPropertiesState(new FilePersistentStorage(),KaaClientPropertiesStateTest.getProperties());
  EventTransport transport=Mockito.mock(EventTransport.class);
  EventFamily eventFamily=Mockito.mock(EventFamily.class);
  EventManager eventManager=new DefaultEventManager(state,transport);
  eventManager.registerEventFamily(eventFamily);
  try {
    eventManager.produceEvent("kaa.test.event.PlayEvent",new byte[0],null);
  }
 catch (  IOException e) {
    assertTrue("Unexpected exception",false);
  }
  Mockito.verify(transport,times(1)).sync();
  eventManager.engageDataChannel();
  try {
    eventManager.produceEvent("kaa.test.event.PlayEvent",new byte[0],null);
  }
 catch (  IOException e) {
    assertTrue("Unexpected exception",false);
  }
  Mockito.verify(transport,times(1)).sync();
  assertTrue(eventManager.releaseDataChannel());
}
