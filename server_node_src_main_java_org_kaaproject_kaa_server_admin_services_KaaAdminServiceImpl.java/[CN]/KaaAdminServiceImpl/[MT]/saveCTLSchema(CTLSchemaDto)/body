{
  this.checkAuthority(KaaAuthorityDto.TENANT_DEVELOPER,KaaAuthorityDto.TENANT_USER);
  try {
    this.checkApplicationId(schema.getApplicationId());
    this.checkTenantId(schema.getTenantId());
    for (    CTLDependencyDto dependency : schema.getDependencies()) {
      CTLSchemaDto found=controlService.getCTLSchemaByFqnAndVersion(dependency.getFqn(),dependency.getVersion());
      Utils.checkNotNull(found);
    }
    try {
      new Schema.Parser().parse(schema.getBody());
    }
 catch (    SchemaParseException cause) {
      throw new IllegalArgumentException("The CTL schema body is not a valid JSON string!");
    }
    return controlService.saveCTLSchema(schema);
  }
 catch (  Exception cause) {
    throw Utils.handleException(cause);
  }
}
