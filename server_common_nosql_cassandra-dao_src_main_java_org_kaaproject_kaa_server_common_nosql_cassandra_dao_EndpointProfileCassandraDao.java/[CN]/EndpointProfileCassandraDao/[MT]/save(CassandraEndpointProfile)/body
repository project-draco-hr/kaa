{
  if (profile.getId() == null) {
    profile.setId(convertKeyHashToString(profile.getEndpointKeyHash()));
  }
  LOG.debug("Saving endpoint profile with id {}",profile.getId());
  ByteBuffer epKeyHash=profile.getEndpointKeyHash();
  Statement saveByAppId=cassandraEPByAppIdDao.getSaveQuery(new CassandraEPByAppId(profile.getApplicationId(),epKeyHash));
  String accessToken=profile.getAccessToken();
  Statement saveByAccessToken=null;
  if (accessToken != null) {
    saveByAccessToken=cassandraEPByAccessTokenDao.getSaveQuery(new CassandraEPByAccessToken(accessToken,epKeyHash));
  }
  Statement saveBySdkTokenId=cassandraEPBySdkTokenDao.getSaveQuery(new CassandraEPBySdkToken(profile.getSdkToken(),epKeyHash));
  Statement saveProfile=getSaveQuery(profile);
  if (saveByAccessToken != null) {
    executeBatch(saveProfile,saveByAppId,saveByAccessToken,saveBySdkTokenId);
  }
 else {
    executeBatch(saveProfile,saveByAppId,saveBySdkTokenId);
  }
  LOG.debug("[{}] Endpoint profile saved",profile.getId());
  return profile;
}
