{
  UpdateStrategy strategy=mock(UpdateStrategy.class);
  OperationsTransport transport=mock(OperationsTransport.class);
  KaaClientProperties props=getProperties();
  KaaClientState state=getClientState(props);
  state.setRegistered(false);
  DefaultUpdateManager manager=getManager(transport,props,state);
  Class<?> managerClass=manager.getClass();
  Field strategyField=managerClass.getDeclaredField("pollStrategy");
  strategyField.setAccessible(true);
  strategyField.set(manager,strategy);
  manager.start();
  manager.stop();
  state.setRegistered(true);
  manager.start();
  manager.onProfileChange(new byte[]{4,3,2,1});
  verify(strategy,times(2)).executeCommand(any(Command.class));
  verify(strategy,times(3)).startPoll();
  verify(strategy,times(3)).stopPoll();
  manager.failover(1L);
  verify(strategy,times(1)).retryCommand(eq(1L),any(Command.class));
}
