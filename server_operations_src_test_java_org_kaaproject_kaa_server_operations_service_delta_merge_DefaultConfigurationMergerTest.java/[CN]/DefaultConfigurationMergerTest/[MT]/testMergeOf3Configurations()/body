{
  Path schemaUrl=Paths.get(Thread.currentThread().getContextClassLoader().getResource("service/delta/merge/schema.json").toURI());
  String configuraionSchema=new String(Files.readAllBytes(schemaUrl));
  SchemaCreator baseSchemaCreator=new SchemaCreatorImpl(new BaseDataSchemaStrategy());
  SchemaCreator overrideSchemaCreator=new SchemaCreatorImpl(new OverrideDataSchemaStrategy());
  String baseSchemaString=baseSchemaCreator.createSchema(new StringReader(configuraionSchema));
  String overrideSchemaString=overrideSchemaCreator.createSchema(new StringReader(configuraionSchema));
  ConfigurationSchemaDto configurationSchema=new ConfigurationSchemaDto();
  configurationSchema.setId("configuration_schema_0");
  configurationSchema.setSchema(configuraionSchema);
  configurationSchema.setBaseSchema(baseSchemaString);
  configurationSchema.setOverrideSchema(overrideSchemaString);
  GenericAvroConverter<GenericRecord> converter=new GenericAvroConverter<>(baseSchemaString);
  EndpointGroupDto endpointGroupWeight0=new EndpointGroupDto();
  endpointGroupWeight0.setId("group_id_0");
  endpointGroupWeight0.setWeight(0);
  Path configuraionWeight0Path=Paths.get(Thread.currentThread().getContextClassLoader().getResource("service/delta/merge/config_weight_0.json").toURI());
  ConfigurationDto configurationWeight0=new ConfigurationDto();
  configurationWeight0.setEndpointGroupId(endpointGroupWeight0.getId());
  configurationWeight0.setSchemaId(configurationSchema.getId());
  configurationWeight0.setBinaryBody(Files.readAllBytes(configuraionWeight0Path));
  EndpointGroupDto endpointGroupWeight1=new EndpointGroupDto();
  endpointGroupWeight1.setId("group_id_1");
  endpointGroupWeight1.setWeight(1);
  Path configuraionWeight1Path=Paths.get(Thread.currentThread().getContextClassLoader().getResource("service/delta/merge/config_weight_1.json").toURI());
  ConfigurationDto configurationWeight1=new ConfigurationDto();
  configurationWeight1.setEndpointGroupId(endpointGroupWeight1.getId());
  configurationWeight1.setSchemaId(configurationSchema.getId());
  configurationWeight1.setBinaryBody(Files.readAllBytes(configuraionWeight1Path));
  EndpointGroupDto endpointGroupWeight2=new EndpointGroupDto();
  endpointGroupWeight2.setId("group_id_2");
  endpointGroupWeight2.setWeight(2);
  Path configuraionWeight2Path=Paths.get(Thread.currentThread().getContextClassLoader().getResource("service/delta/merge/config_weight_2.json").toURI());
  ConfigurationDto configurationWeight2=new ConfigurationDto();
  configurationWeight2.setEndpointGroupId(endpointGroupWeight2.getId());
  configurationWeight2.setSchemaId(configurationSchema.getId());
  configurationWeight2.setBinaryBody(Files.readAllBytes(configuraionWeight2Path));
  List<EndpointGroupDto> endpointGroups=new ArrayList<>();
  endpointGroups.add(endpointGroupWeight0);
  endpointGroups.add(endpointGroupWeight1);
  endpointGroups.add(endpointGroupWeight2);
  List<ConfigurationDto> configurations=new ArrayList<>();
  configurations.add(configurationWeight0);
  configurations.add(configurationWeight1);
  configurations.add(configurationWeight2);
  Path mergedConfiguraionPath=Paths.get(Thread.currentThread().getContextClassLoader().getResource("service/delta/merge/merged_config.json").toURI());
  String mergedConfiguraionBody=new String(Files.readAllBytes(mergedConfiguraionPath));
  ConfigurationMerger merger=new DefaultConfigurationMerger();
  byte[] mergeResult=merger.merge(endpointGroups,configurations,configurationSchema);
  GenericRecord mergeResultGenericRecord=converter.decodeJson(mergeResult);
  GenericRecord expectedMergedConfiguraionGenericRecord=converter.decodeJson(mergedConfiguraionBody);
  Assert.assertTrue(mergeResultGenericRecord.equals(expectedMergedConfiguraionGenericRecord));
}
