{
  try {
    VelocityContext context=new VelocityContext();
    context.put("headerName",generatedSourceName);
    StringWriter hdrWriter=new StringWriter();
    engine.getTemplate("header.tmpl").merge(context,hdrWriter);
    StringWriter srcWriter=new StringWriter();
    engine.getTemplate("source.tmpl").merge(context,srcWriter);
    if (toFile) {
      writeToFile(hdrWriter,srcWriter);
    }
 else {
      writeToStream(hdrWriter,srcWriter);
    }
  }
 catch (  Exception e) {
    LOG.error("Failed to prepare source templates: ",e);
    throw new KaaCGeneratorException("Failed to prepare source templates: " + e.toString());
  }
}
