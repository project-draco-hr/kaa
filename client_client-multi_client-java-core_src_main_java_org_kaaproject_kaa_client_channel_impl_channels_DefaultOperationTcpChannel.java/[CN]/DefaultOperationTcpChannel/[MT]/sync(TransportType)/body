{
  if (isShutdown) {
    LOG.info("Can't sync. Channel [{}] is down",getId());
    return;
  }
  if (isPaused) {
    LOG.info("Can't sync. Channel [{}] is paused",getId());
    return;
  }
  if (!isFirstResponseReceived) {
    LOG.info("Can't sync. Channel [{}] is waiting for CONNACK message + KAASYNC message",getId());
    isPendingSyncRequest=true;
    return;
  }
  LOG.info("Processing sync {} for channel [{}]",type,getId());
  if (multiplexer != null && demultiplexer != null) {
    if (currentServer != null && socket != null) {
      ChannelDirection direction=getSupportedTransportTypes().get(type);
      if (direction != null) {
        Map<TransportType,ChannelDirection> typeMap=new HashMap<>(getSupportedTransportTypes().size());
        typeMap.put(type,direction);
        for (        Map.Entry<TransportType,ChannelDirection> typeIt : getSupportedTransportTypes().entrySet()) {
          if (!typeIt.getKey().equals(type)) {
            typeMap.put(typeIt.getKey(),ChannelDirection.DOWN);
          }
        }
        try {
          sendKaaSyncRequest(typeMap);
        }
 catch (        Exception e) {
          LOG.error("Failed to sync channel [{}]",getId());
          LOG.error("Stack trace: ",e);
          onServerFailed();
        }
      }
 else {
        LOG.error("Unsupported type {} for channel [{}]",type,getId());
      }
    }
 else {
      LOG.warn("Can't sync. Server is {}, socket is \"{}\"",currentServer,socket);
    }
  }
}
