{
  PrivateKey privateKey=null;
  LOG.debug("Check if key exists {}",clientPrivateKeyFileLocation);
  if (storage.exists(clientPrivateKeyFileLocation)) {
    try {
      InputStream input=storage.openForRead(clientPrivateKeyFileLocation);
      privateKey=KeyUtil.getPrivate(input);
    }
 catch (    Exception e) {
      LOG.error("Error loading Client Private Key",e);
      throw new RuntimeException(e);
    }
  }
  if (privateKey == null) {
    LOG.debug("Generating Client Key pair");
    try {
      OutputStream privateKeyOutput=storage.openForWrite(clientPrivateKeyFileLocation);
      OutputStream publicKeyOutput=storage.openForWrite(clientPublicKeyFileLocation);
      KeyPair kp=KeyUtil.generateKeyPair(privateKeyOutput,publicKeyOutput);
      updateEndpointKeyHash(kp);
      privateKey=kp.getPrivate();
    }
 catch (    IOException e) {
      LOG.error("Error generating Client Key pair",e);
      throw new RuntimeException(e);
    }
  }
  return privateKey;
}
