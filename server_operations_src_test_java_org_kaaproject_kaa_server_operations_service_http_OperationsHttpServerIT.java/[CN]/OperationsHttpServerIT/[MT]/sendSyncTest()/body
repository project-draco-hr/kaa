{
  try {
    final HttpTestSyncClient cl1=new HttpTestSyncClient(serverPublicKey,new HttpActivity<SyncResponse>(){
      @Override public void httpRequestComplete(      Exception ioe,      int id,      SyncResponse response){
        assertNull(ioe);
        if (syncTests.containsKey(Integer.valueOf(id))) {
          SyncTest<SyncRequest,SyncResponse> test=syncTests.get(Integer.valueOf(id));
          test.responseReceived=response;
          testProcessed++;
        }
 else {
          logger.trace("Test failed: not found in HashMap id: " + id);
        }
        if (testProcessed >= NUMBER_OF_TESTS) {
synchronized (sync) {
            sync.notify();
          }
        }
      }
    }
);
    testCacheService.addPublicKey(cl1.getClientPublicKeyHash(),cl1.getClientPublicKey());
    syncTests.putIfAbsent(Integer.valueOf(cl1.getId()),new SyncTest<SyncRequest,SyncResponse>(cl1.getId(),cl1.getRequest()));
    executor.execute(cl1);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.toString());
  }
}
