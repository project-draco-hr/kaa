{
  try {
    final HttpTestLongSyncClient cl1=new HttpTestLongSyncClient(serverPublicKey,new HttpActivity<SyncResponse>(){
      @Override public void httpRequestComplete(      Exception ioe,      int id,      SyncResponse response){
        assertNull(ioe);
synchronized (longSyncTests) {
          if (longSyncTests.containsKey(Integer.valueOf(id))) {
            SyncTest<LongSyncRequest,SyncResponse> test=longSyncTests.get(Integer.valueOf(id));
            test.responseReceived=response;
            testProcessed++;
          }
 else {
            logger.trace("Test failed: not found in HashMap id: " + id);
          }
        }
        if (testProcessed >= NUMBER_OF_TESTS) {
synchronized (sync) {
            sync.notify();
          }
        }
      }
    }
);
    testCacheService.addPublicKey(cl1.getClientPublicKeyHash(),cl1.getClientPublicKey());
    longSyncTests.putIfAbsent(Integer.valueOf(cl1.getId()),new SyncTest<LongSyncRequest,SyncResponse>(cl1.getId(),cl1.getRequest()));
    executor.execute(cl1);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.toString());
  }
}
