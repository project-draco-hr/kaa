{
synchronized (buckets) {
    if (this.getConsumedVolume() + record.getSize() > maxStorageSize) {
      removeOldestRecord(MAX_STORAGE_SIZE);
    }
    if (buckets.isEmpty()) {
      initBucketList();
    }
    if (currentBucket.isUsed() || !currentBucket.tryPushRecord(record)) {
      Bucket newBucket=new Bucket(maxBucketSize);
      buckets.add(newBucket);
      currentBucket=newBucket;
      currentBucket.tryPushRecord(record);
    }
    consumedSize+=record.getSize();
    ++recordCount;
    LOG.trace("Added new log record, records: {}",recordCount);
  }
}
