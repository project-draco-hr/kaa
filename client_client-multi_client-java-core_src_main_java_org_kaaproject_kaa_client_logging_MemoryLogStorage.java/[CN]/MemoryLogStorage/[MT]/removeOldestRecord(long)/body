{
synchronized (buckets) {
    if (!buckets.isEmpty()) {
      long currentRecordCount=recordCount;
      LOG.info("Removing oldest log records up to {}B",maximumAllowedVolume);
      Iterator<Bucket> it=buckets.iterator();
      while (it.hasNext()) {
        Bucket bucket=it.next();
        if (!bucket.isUsed()) {
          long newConsumedSize=consumedSize - bucket.getConsumedSize();
          if (newConsumedSize > maximumAllowedVolume) {
            consumedSize=newConsumedSize;
            recordCount-=bucket.getRecords().size();
            it.remove();
          }
 else {
            while (consumedSize > maximumAllowedVolume) {
              consumedSize-=bucket.popRecord().getSize();
              --recordCount;
            }
          }
        }
      }
      LOG.info("{} log records was forcibly removed",(currentRecordCount - recordCount));
      resize(maxBucketSize,maxRecordCount);
    }
  }
}
