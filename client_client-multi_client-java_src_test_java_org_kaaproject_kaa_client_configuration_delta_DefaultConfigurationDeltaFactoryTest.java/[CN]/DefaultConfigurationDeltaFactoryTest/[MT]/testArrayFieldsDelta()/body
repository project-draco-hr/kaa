{
  URL schemaUrl=Thread.currentThread().getContextClassLoader().getResource("configuration/manager/arrayFieldsDeltaSchema.json");
  Schema schema=new Schema.Parser().parse(new File(schemaUrl.getPath()));
  GenericRecord delta=new GenericData.Record(DefaultConfigurationManagerTest.getDeltaSchemaByFullName(schema,"org.kaa.config.testT"));
  DefaultConfigurationManagerTest.fillArrayFullResyncDelta(delta);
  ConfigurationDeltaFactory factory=new DefaultConfigurationDeltaFactory();
  ConfigurationDelta result=factory.createDelta(delta);
  assertTrue(result.hasChanged("testField1"));
  DeltaType testField1=result.getDeltaType("testField1");
  assertFalse(testField1.isDefault());
  assertFalse(testField1.isReset());
  assertNull(testField1.getNewValue());
  assertNull(testField1.getRemovedItems());
  List<Object> array=testField1.getAddedItems();
  ConfigurationDelta item1=(ConfigurationDelta)array.get(0);
  Integer item1Value=(Integer)item1.getDeltaType("testField2").getNewValue();
  assertEquals(new Integer(1),item1Value);
  ConfigurationDelta item2=(ConfigurationDelta)array.get(1);
  Integer item2Value=(Integer)item2.getDeltaType("testField2").getNewValue();
  assertEquals(new Integer(2),item2Value);
  ConfigurationDelta item3=(ConfigurationDelta)array.get(2);
  Integer item3Value=(Integer)item3.getDeltaType("testField2").getNewValue();
  assertEquals(new Integer(3),item3Value);
  GenericRecord itemRecord2=new GenericData.Record(DefaultConfigurationManagerTest.getDeltaSchemaByFullName(schema,"org.kaa.config.testRecordItemT"));
  DefaultConfigurationManagerTest.fillArrayItemUpdateDelta(itemRecord2);
  result=factory.createDelta(itemRecord2);
  assertTrue(result.hasChanged("testField2"));
  Integer testField2=(Integer)result.getDeltaType("testField2").getNewValue();
  assertEquals(new Integer(22),testField2);
  DefaultConfigurationManagerTest.fillArrayItemRemoveDelta(delta);
  result=factory.createDelta(delta);
  testField1=result.getDeltaType("testField1");
  assertFalse(testField1.isDefault());
  assertFalse(testField1.isReset());
  assertNull(testField1.getNewValue());
  assertNull(testField1.getAddedItems());
  List<DeltaHandlerId> handlers=testField1.getRemovedItems();
  assertNotNull(handlers);
  assertEquals(1,handlers.size());
  DefaultConfigurationManagerTest.fillArrayResetDelta(delta);
  result=factory.createDelta(delta);
  testField1=result.getDeltaType("testField1");
  assertFalse(testField1.isDefault());
  assertTrue(testField1.isReset());
  assertNull(testField1.getNewValue());
  assertNull(testField1.getAddedItems());
  assertNull(testField1.getRemovedItems());
}
