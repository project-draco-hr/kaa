{
  NettyKaaTcpServer server=new NettyKaaTcpServer(config,new AbstractKaaTcpServerInitializer(){
    @Override protected SimpleChannelInboundHandler<AbstractKaaTcpCommandProcessor> getMainHandler(    UUID uuid){
      return new SimpleChannelInboundHandler<AbstractKaaTcpCommandProcessor>(){
        @Override protected void channelRead0(        ChannelHandlerContext ctx,        AbstractKaaTcpCommandProcessor msg) throws Exception {
          MqttFrame frame=msg.getRequest();
          LOG.debug("Received frame: {}",frame);
          msg.setRequest(frame);
          if (msg.getSyncTime() == 0) {
            msg.setSyncTime(System.currentTimeMillis());
          }
          if (frame.getMessageType() == MessageType.PINGREQ) {
            ctx.writeAndFlush(new PingResponse());
          }
 else           if (frame.getMessageType() == MessageType.PINGRESP) {
            throw new RuntimeException("not supported command");
          }
 else {
            throw new BadRequestException("not supported command");
          }
        }
      }
;
    }
  }
);
  return server;
}
