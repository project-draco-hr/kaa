{
  ChannelContext channelContextMock=Mockito.mock(ChannelContext.class);
  SyncRequest request=new SyncRequest();
  request.setRequestId(REQUEST_ID);
  SyncRequestMetaData md=buildSyncRequestMetaData();
  request.setSyncRequestMetaData(md);
  ConfigurationSyncRequest csRequest=new ConfigurationSyncRequest();
  request.setConfigurationSyncRequest(csRequest);
  Mockito.when(cacheService.getEndpointKey(EndpointObjectHash.fromBytes(clientPublicKeyHash.array()))).thenReturn(clientPair.getPublic());
  whenSync(deltaResponseWithProfile);
  MessageBuilder responseBuilder=Mockito.mock(MessageBuilder.class);
  ErrorBuilder errorBuilder=Mockito.mock(ErrorBuilder.class);
  SessionInitMessage message=toSignedRequest(UUID.randomUUID(),ChannelType.SYNC_WITH_TIMEOUT,channelContextMock,request,responseBuilder,errorBuilder);
  Assert.assertNotNull(akkaService.getActorSystem());
  akkaService.process(message);
  Mockito.verify(operationsService,Mockito.timeout(TIMEOUT).atLeastOnce()).syncProfile(Mockito.any(SyncContext.class),Mockito.any(ProfileClientSync.class));
  Notification thriftNotification=new Notification();
  thriftNotification.setAppId(APP_ID);
  thriftNotification.setOp(Operation.UPDATE_SERVER_PROFILE);
  thriftNotification.setKeyHash(clientPublicKeyHash);
  akkaService.onNotification(thriftNotification);
  Mockito.verify(operationsService,Mockito.timeout(TIMEOUT * 100).atLeastOnce()).getServerEndpointProfile(EndpointObjectHash.fromBytes(clientPublicKeyHash.array()));
}
