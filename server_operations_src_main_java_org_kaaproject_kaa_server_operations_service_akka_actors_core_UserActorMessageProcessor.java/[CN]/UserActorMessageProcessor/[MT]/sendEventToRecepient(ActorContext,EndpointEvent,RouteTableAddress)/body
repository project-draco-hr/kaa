{
  if (!eventDeliveryTable.isDeliveryStarted(event,recipient)) {
    if (recipient.isLocal()) {
      LOG.debug("[{}] forwarding event {} to local recepient {}",userId,event,recipient);
      EndpointEventReceiveMessage message=new EndpointEventReceiveMessage(userId,Collections.singletonList(event),recipient,context.self());
      sendEventToLocal(context,message);
    }
 else {
      LOG.debug("[{}] forwarding event {} to remote recepient {}",userId,event,recipient);
      RemoteEndpointEvent remoteEvent=new RemoteEndpointEvent(tenantId,userId,event,recipient);
      eventService.sendEvent(remoteEvent);
    }
    LOG.debug("[{}] registering delivery attempt of event {} to recepient {}",userId,event,recipient);
    eventDeliveryTable.registerDeliveryAttempt(event,recipient);
  }
}
