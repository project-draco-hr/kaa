{
  if (firstConnectRequestToActor) {
    firstConnectRequestToActor=false;
    eventService.sendUserRouteInfo(new UserRouteInfo(tenantId,userId));
  }
  EndpointObjectHash endpointKey=message.getKey();
  String appToken=message.getAppToken();
  RouteTableAddress address=new RouteTableAddress(endpointKey,appToken);
  List<EventClassFamilyVersion> ecfVersions=message.getEcfVersions();
  for (  EventClassFamilyVersion ecfVersion : ecfVersions) {
    RouteTableKey key=new RouteTableKey(appToken,ecfVersion);
    updateRouteTable(context,key,address);
  }
  for (  String serverId : routeTable.getRemoteServers()) {
    if (routeTable.isDeliveryRequired(serverId,address)) {
      LOG.debug("[{}] Sending route info about address {} to server {}",userId,address,serverId);
      eventService.sendRouteInfo(new RouteInfo(tenantId,userId,address,ecfVersions),serverId);
    }
  }
  versionMap.put(endpointKey,message.getEcfVersions());
  endpoints.put(getActorPathName(message.getOriginator()),endpointKey);
}
