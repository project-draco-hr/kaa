{
  this.robots=new HashMap<>(context.getEmulatorRobots());
  this.context=context;
  Labyrinth saved=EmulatorManager.loadLabyrinth();
  if (saved != null) {
    this.labyrinth=saved;
    labyrinthGenerated=true;
  }
 else {
    this.labyrinth=new BasicLabyrinth(context.getLabyrinth().getWidth(),context.getLabyrinth().getHeight());
  }
  this.listener=listener;
  setLayout(new BorderLayout());
  JPanel statusPanel=new JPanel(new FlowLayout(FlowLayout.LEFT));
  statusLabel=new JLabel();
  statusPanel.add(statusLabel);
  generateLabyrinthButton=new JButton("Generate maze");
  generateLabyrinthButton.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      generateLabyrinth();
    }
  }
);
  placeRobotsButton=new JButton("Place robots");
  placeRobotsButton.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      placeRobots();
    }
  }
);
  resetButton=new JButton("Reset");
  resetButton.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      reset(true);
    }
  }
);
  statusPanel.add(generateLabyrinthButton);
  statusPanel.add(placeRobotsButton);
  statusPanel.add(resetButton);
  add(statusPanel,BorderLayout.NORTH);
  JPanel buttonPanel=new JPanel();
  add(buttonPanel,BorderLayout.SOUTH);
  buttonPanel.setLayout(new FlowLayout(FlowLayout.RIGHT));
  okButton=new JButton("Start Emulator");
  okButton.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      EmulatorSetupDialog.this.dispose();
      EmulatorSetupDialog.this.listener.onEmulatorSetupDialogOk(robots);
    }
  }
);
  JButton closeButton=new JButton("Close");
  closeButton.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      EmulatorSetupDialog.this.dispose();
      EmulatorSetupDialog.this.listener.onEmulatorSetupDialogCancel();
    }
  }
);
  buttonPanel.add(okButton);
  buttonPanel.add(closeButton);
  surfacePanel=new EmulatorSetupSurface(labyrinth);
  add(surfacePanel,BorderLayout.CENTER);
  if (!robots.isEmpty()) {
    placeRobots();
    okButton.setEnabled(true);
  }
 else {
    reset(false);
  }
}
