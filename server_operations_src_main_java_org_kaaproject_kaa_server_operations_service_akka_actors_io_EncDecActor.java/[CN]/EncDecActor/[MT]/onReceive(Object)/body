{
  LOG.debug("Received: {}",message);
  if (message instanceof SessionInitRequest) {
    RedirectionRule redirection=checkRedirection(redirectionRules,random.nextDouble());
    if (redirection == null) {
      messageProcessor.decodeAndForward(context(),(SessionInitRequest)message);
    }
 else {
      messageProcessor.redirect(redirection,(SessionInitRequest)message);
    }
  }
 else   if (message instanceof SessionAware) {
    if (message instanceof SessionAwareRequest) {
      RedirectionRule redirection=checkRedirection(redirectionRules,random.nextDouble());
      if (redirection == null) {
        messageProcessor.decodeAndForward(context(),(SessionAwareRequest)message);
      }
 else {
        messageProcessor.redirect(redirection,(SessionAwareRequest)message);
      }
    }
 else {
      messageProcessor.forward(context(),(SessionAware)message);
    }
  }
 else   if (message instanceof SessionResponse) {
    messageProcessor.encodeAndReply((SessionResponse)message);
  }
 else   if (message instanceof RedirectionRule) {
    applyRedirectionRule((RedirectionRule)message);
  }
 else   if (message instanceof RuleTimeoutMessage) {
    removeRedirectionRule((RuleTimeoutMessage)message);
  }
}
