{
  if (!ignoreNextUpdate) {
    GenericArray<GenericRecord> deltaArray=new GenericData.Array<GenericRecord>(1,schema);
    GenericRecord deltaT=new GenericData.Record(schema.getElementType());
    deltaT.put("delta",CommonToGeneric.createRecord(configuration));
    deltaArray.add(deltaT);
    GenericAvroConverter<GenericArray<GenericRecord>> converter=new GenericAvroConverter<GenericArray<GenericRecord>>(schema);
    byte[] byteArray=null;
    try {
      byteArray=converter.encode(deltaArray);
    }
 catch (    IOException e) {
      throw new ConfigurationRuntimeException("Failed to encode configuration data");
    }
    configurationHash=EndpointObjectHash.fromSHA1(byteArray);
    if (storage != null) {
      ByteBuffer buffer=ByteBuffer.wrap(byteArray);
      storage.saveConfiguration(buffer);
    }
  }
 else {
    ignoreNextUpdate=false;
  }
}
