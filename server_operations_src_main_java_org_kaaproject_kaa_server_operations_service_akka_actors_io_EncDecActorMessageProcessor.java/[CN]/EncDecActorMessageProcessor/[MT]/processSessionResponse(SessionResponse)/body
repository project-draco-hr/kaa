{
  NettySessionInfo session=message.getSessionInfo();
  byte[] responseData=responseConverter.toByteArray(message.getResponse());
  LOG.trace("Response data serialized");
  if (session.isEncrypted()) {
    crypt.setDecodedSessionKey(session.getSessionKey());
    responseData=crypt.encodeData(responseData);
    LOG.trace("Response data crypted");
  }
  ChannelHandlerContext context=message.getSessionInfo().getCtx();
  ResponseBuilder converter=message.getResponseConverter();
  Object[] objects=converter.build(responseData,session.isEncrypted());
  if (objects != null && objects.length > 0) {
    for (    Object object : objects) {
      context.write(object);
    }
    context.flush();
  }
}
