{
  ControlServiceImpl controlService=Mockito.spy(new ControlServiceImpl());
  ReflectionTestUtils.setField(controlService,"host","localhost");
  ReflectionTestUtils.setField(controlService,"port",9090);
  ControlZkService zkService=Mockito.mock(ControlZkService.class);
  Mockito.doNothing().when(zkService).start();
  Mockito.doNothing().when(zkService).stop();
  LoadDistributionService loadMgmtService=Mockito.mock(LoadDistributionService.class);
  Mockito.doNothing().when(loadMgmtService).start();
  Mockito.doNothing().when(loadMgmtService).shutdown();
  ReflectionTestUtils.setField(controlService,"controlZkService",zkService);
  ReflectionTestUtils.setField(controlService,"loadMgmtService",loadMgmtService);
  ControlThriftService.Iface controlThriftService=Mockito.mock(ControlThriftService.Iface.class);
  ReflectionTestUtils.setField(controlService,"controlService",controlThriftService);
  TServerSocket serverSocket=Mockito.mock(TServerSocket.class);
  Mockito.doReturn(serverSocket).when(controlService).createServerSocket();
  return controlService;
}
